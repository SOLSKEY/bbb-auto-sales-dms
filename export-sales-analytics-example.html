<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Export Sales Analytics Example</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }

        #sales-analytics-export-container {
            border: 2px solid #e0e0e0;
            padding: 20px;
            margin: 20px 0;
            background: white;
        }

        .export-button {
            padding: 12px 24px;
            background-color: #2563eb;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }

        .export-button:hover {
            background-color: #1d4ed8;
        }

        .export-button:disabled {
            background-color: #9ca3af;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <h1>Sales Analytics Report Export Example</h1>

    <button id="exportButton" class="export-button">
        Export Sales Analytics Report
    </button>

    <div id="sales-analytics-export-container">
        <h2>Sales Analytics Dashboard</h2>
        <p>This is the content that will be exported as a PNG image.</p>
        <div style="display: flex; gap: 20px; margin-top: 20px;">
            <div style="flex: 1; padding: 15px; background: #f3f4f6; border-radius: 8px;">
                <h3>Total Sales</h3>
                <p style="font-size: 24px; font-weight: bold;">$125,430</p>
            </div>
            <div style="flex: 1; padding: 15px; background: #f3f4f6; border-radius: 8px;">
                <h3>Units Sold</h3>
                <p style="font-size: 24px; font-weight: bold;">342</p>
            </div>
            <div style="flex: 1; padding: 15px; background: #f3f4f6; border-radius: 8px;">
                <h3>Average Price</h3>
                <p style="font-size: 24px; font-weight: bold;">$366</p>
            </div>
        </div>
    </div>

    <!-- Load html-to-image from CDN -->
    <script type="module">
        import { toPng } from 'https://cdn.skypack.dev/html-to-image@1.11.13';

        const exportButton = document.getElementById('exportButton');

        exportButton.addEventListener('click', async () => {
            // Disable button and show loading state
            exportButton.disabled = true;
            exportButton.textContent = 'Exporting...';

            try {
                // Get the target container
                const element = document.getElementById('sales-analytics-export-container');

                if (!element) {
                    alert('Export container not found!');
                    return;
                }

                // Generate the PNG with high quality settings
                const dataUrl = await toPng(element, {
                    cacheBust: true,
                    pixelRatio: 3, // High resolution (3x DPR)
                    width: 2000, // Force viewport width to 2000px
                    height: element.scrollHeight, // Use actual content height
                    style: {
                        // Ensure the element renders as if viewport is 2000px wide
                        width: '2000px',
                        maxWidth: '2000px',
                        minWidth: '2000px'
                    }
                });

                // Create download link
                const link = document.createElement('a');
                const date = new Date().toISOString().split('T')[0]; // Format: YYYY-MM-DD
                link.download = `Sales_Report_${date}.png`;
                link.href = dataUrl;
                link.click();

                console.log('Export successful!');

            } catch (error) {
                console.error('Failed to export sales analytics:', error);
                alert('Failed to export report. Please try again.');
            } finally {
                // Re-enable button
                exportButton.disabled = false;
                exportButton.textContent = 'Export Sales Analytics Report';
            }
        });
    </script>
</body>
</html>
